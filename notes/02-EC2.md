# EC2 – Elastic Compute Cloud

## Overview

EC2 provides **resizable virtual machines** in the cloud. Key concepts for the Developer exam focus on instance types, storage, networking, and how applications interact with EC2.

---

## Instance Types (Summary)

| Family | Use Case |
|--------|----------|
| **General Purpose** (t, m) | Web servers, small databases |
| **Compute Optimized** (c) | CPU-intensive apps, batch processing |
| **Memory Optimized** (r, x) | In-memory databases, real-time analytics |
| **Storage Optimized** (i, d) | High I/O, NoSQL databases |
| **Accelerated Computing** (p, g) | Machine learning, GPU workloads |

### T-series Burstable Instances
- Earn **CPU credits** when idle; spend credits when CPU spikes.
- `T3 Unlimited` allows unlimited bursting (additional charges apply).

---

## Purchasing Options

| Option | Best For |
|--------|----------|
| **On-Demand** | Short-term, unpredictable workloads |
| **Reserved** (1 or 3 years) | Steady-state, predictable usage (up to 72% savings) |
| **Savings Plans** | Flexible usage commitment (similar savings to Reserved) |
| **Spot Instances** | Fault-tolerant, flexible workloads (up to 90% savings; can be interrupted) |
| **Dedicated Hosts** | Compliance, bring-your-own-license |
| **Dedicated Instances** | Single-tenant hardware |

---

## Storage

### EBS – Elastic Block Store
- Network-attached, **persistent** block storage.
- Bound to a single Availability Zone.
- Types:
  - `gp2/gp3` – General purpose SSD (default)
  - `io1/io2` – Provisioned IOPS SSD (high performance databases)
  - `st1` – Throughput optimized HDD (big data, log processing)
  - `sc1` – Cold HDD (infrequent access)
- **Snapshots** – Point-in-time backups stored in S3; can copy across regions.

### Instance Store
- **Ephemeral** storage physically attached to the host.
- Extremely high IOPS but data is **lost** if the instance stops/terminates.

### EFS – Elastic File System
- Managed **NFS** (Network File System).
- Can be mounted on **multiple EC2 instances** across AZs.
- Auto-scales; pay per use.
- Not available on Windows instances (use FSx for Windows).

---

## Networking

### Security Groups
- Virtual firewall at the instance/ENI level.
- **Stateful** – return traffic is automatically allowed.
- Rules: allow only (no explicit deny).
- Can reference other security groups (useful within the same VPC).

### Elastic IP
- Static public IP that persists across instance stop/start.
- Limit of 5 per account by default.

### ENI – Elastic Network Interface
- Virtual network card; can be attached/detached between instances.
- Useful for failover (move ENI from one instance to another).

### Placement Groups
| Type | Description |
|------|-------------|
| **Cluster** | All instances in one rack – low latency, high risk |
| **Spread** | Instances on different hardware – high availability |
| **Partition** | Groups of instances in separate partitions – HDFS, Kafka |

---

## IAM Roles for EC2

- Assign an **IAM Instance Profile** to an EC2 instance to grant it AWS API permissions.
- Credentials are automatically rotated and available via the **Instance Metadata Service (IMDS)**.
- Never store AWS credentials on EC2 – always use roles.

---

## User Data & Metadata

### User Data
- Script executed on **first boot** (runs as root).
- Used to install software, configure the instance.

```bash
#!/bin/bash
yum update -y
yum install -y httpd
systemctl start httpd
```

### Instance Metadata Service (IMDS)
- Available at `http://169.254.169.254/latest/meta-data/`
- IMDSv2 (recommended) requires a session token:

```bash
TOKEN=$(curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600")
curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/meta-data/iam/security-credentials/
```

---

## Auto Scaling Groups (ASG)

- Automatically add/remove EC2 instances based on demand.
- Requires a **Launch Template** (or older Launch Configuration).
- Integrates with **ELB** to register/deregister instances.
- Scaling policies:
  - **Target Tracking** – maintain a metric at a target value (e.g., 60% CPU).
  - **Step Scaling** – scale based on CloudWatch alarm thresholds.
  - **Scheduled Scaling** – scale at a specific time.
  - **Predictive Scaling** – ML-based forecasting.
- **Cooldown period** – prevents rapid scale-in/out (default 300 s).
- **Lifecycle Hooks** – pause instances during launch or termination to run custom scripts.

---

## Exam Tips

- By default, EC2 instances do not have public IPs unless launched in a public subnet with auto-assign enabled or an Elastic IP.
- EBS volumes are **not** automatically deleted when an instance terminates (configurable via `DeleteOnTermination` attribute).
- Spot Instances receive a **2-minute warning** before interruption via EC2 instance metadata.
- For high I/O, use io2 Block Express or instance store, not gp2/gp3.
- Terminate Protection prevents accidental termination but does NOT block ASG from terminating instances.
