# S3 – Simple Storage Service

## Overview

S3 is an **object storage** service with virtually unlimited capacity. Objects are stored in **buckets**, and buckets are globally unique but **region-specific**.

- Maximum object size: **5 TB**
- Single PUT upload limit: **5 GB** (use Multipart Upload for larger files)
- Key naming: full path treated as the key (e.g., `folder/subfolder/file.txt`)

---

## Storage Classes

| Class | Use Case | Availability | Min Storage Duration |
|-------|----------|-------------|----------------------|
| **S3 Standard** | Frequently accessed data | 99.99% | None |
| **S3 Intelligent-Tiering** | Unknown / changing access patterns | 99.9% | None |
| **S3 Standard-IA** | Infrequently accessed, rapid retrieval | 99.9% | 30 days |
| **S3 One Zone-IA** | IA, single AZ (non-critical data) | 99.5% | 30 days |
| **S3 Glacier Instant Retrieval** | Archive, millisecond access | 99.9% | 90 days |
| **S3 Glacier Flexible Retrieval** | Archive, minutes–hours retrieval | 99.99% | 90 days |
| **S3 Glacier Deep Archive** | Rarely accessed, 12-hour retrieval | 99.99% | 180 days |

---

## Versioning

- Enabled at the bucket level.
- Protects against accidental overwrites/deletes.
- Deleted objects get a **Delete Marker** (not physically removed).
- Restoring a version: delete the Delete Marker.
- Suspending versioning does not remove existing versions.

---

## Security

### Bucket Policies
- Resource-based JSON policy applied to the entire bucket.
- Can grant cross-account access.
- Evaluated before ACLs.

### ACLs (Access Control Lists)
- Legacy mechanism; AWS recommends disabling ACLs and using bucket policies.

### Block Public Access
- Bucket-level and account-level setting to prevent public access.
- Enabled by default on new buckets.

### Pre-Signed URLs
- Temporary URL granting access to a private object.
- Inherits the permissions of the creator.
- Useful for time-limited file sharing.

```bash
aws s3 presign s3://my-bucket/my-object.txt --expires-in 3600
```

### S3 Object Lock & Glacier Vault Lock
- **Object Lock** – WORM (Write Once Read Many); prevents object deletion.
  - Retention modes: **Compliance** (no one can change) vs **Governance** (admin can override).
  - Legal Hold: keeps object locked indefinitely until explicitly removed.

---

## Encryption

| Method | Description |
|--------|-------------|
| **SSE-S3** | AWS manages keys; AES-256 (default on new buckets) |
| **SSE-KMS** | KMS-managed keys; audit trail, user-controlled rotation |
| **SSE-C** | Customer-provided keys; AWS does not store the key |
| **Client-Side Encryption** | Encrypt before uploading; fully client-managed |

- Use `x-amz-server-side-encryption: aws:kms` header to enforce SSE-KMS.
- Bucket policies can deny uploads without encryption headers.

---

## Performance

### Multipart Upload
- Recommended for objects > 100 MB; **required** for objects > 5 GB.
- Parallel uploads improve throughput.
- Incomplete parts are not automatically cleaned up – use a Lifecycle rule.

### S3 Transfer Acceleration
- Routes uploads through AWS **CloudFront edge locations** for faster long-distance transfers.

### Byte-Range Fetches
- Retrieve specific byte ranges in parallel (speeds up downloads for large objects).

### S3 Select / Glacier Select
- Run SQL queries directly on S3 objects (CSV, JSON, Parquet) without downloading them.

---

## Static Website Hosting
- Enable on a bucket; index and error documents required.
- Bucket must be public (or use CloudFront OAC/OAI for private origins).
- URL format: `http://<bucket>.s3-website.<region>.amazonaws.com`

---

## Replication

| Type | Description |
|------|-------------|
| **CRR (Cross-Region Replication)** | Compliance, lower latency in different regions |
| **SRR (Same-Region Replication)** | Log aggregation, live replication between accounts |

- Versioning must be enabled on **both** source and destination buckets.
- Existing objects are **not** replicated automatically (use S3 Batch Operations).

---

## Event Notifications

- Trigger events on `s3:ObjectCreated`, `s3:ObjectRemoved`, etc.
- Destinations: **SNS**, **SQS**, **Lambda**, or **EventBridge**.
- EventBridge provides more filtering options and can fan out to multiple targets.

---

## Lifecycle Rules

- Automate transitions between storage classes or expiration of objects.
- Apply to all objects or filtered by prefix/tag.

Example:
```
After 30 days → move to Standard-IA
After 90 days → move to Glacier
After 365 days → expire (delete)
```

---

## CORS (Cross-Origin Resource Sharing)

- Required when a web app accesses S3 from a different domain.
- Configure a CORS rule on the S3 bucket (not the CloudFront distribution).

---

## S3 Access Points

- Simplify access management for shared datasets.
- Each Access Point has its own policy and can be restricted to a specific VPC.

---

## Exam Tips

- S3 is **not** a file system – it is object storage (no directory hierarchy; prefixes simulate folders).
- Strong **read-after-write consistency** for all operations (since December 2020).
- Max part size in Multipart Upload: 5 GB; min: 5 MB (except last part).
- Use **Signed URLs** for temporary private access; use **Bucket Policies** for permanent access controls.
- KMS API calls for SSE-KMS count against your KMS quota – can cause throttling for high-traffic buckets.
- `s3:ListBucket` applies to the bucket ARN; `s3:GetObject` applies to `arn:aws:s3:::bucket/*`.
